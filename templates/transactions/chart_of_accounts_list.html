{% extends 'base.html' %}

{% block title %}Chart of Accounts - ACCORIX{% endblock %}

{% block content %}
<div class="page-title">
    <div>
        <h1>Chart of Accounts</h1>
        <p style="color: var(--muted); margin: 0;">Manage your accounting structure</p>
    </div>
    <div style="display: flex; gap: 10px;">
        <a href="{% url 'chart_of_accounts_create' %}" class="btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
                <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
            </svg>
            New Account
        </a>
    </div>
</div>

<!-- Filter Section -->
<div class="card" style="margin-bottom: 20px;">
    <form method="get" class="form-row">
        <div class="form-group">
            <label>Account Type</label>
            <select name="type" class="form-control">
                <option value="">All Types</option>
                {% for value, label in account_types %}
                <option value="{{ value }}" {% if current_type == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label>Search</label>
            <input type="text" name="search" class="form-control" placeholder="Search accounts..." value="{{ search }}">
        </div>
        <div class="form-group">
            <label>&nbsp;</label>
            <button type="submit" class="btn-primary">Filter</button>
        </div>
    </form>
</div>

<!-- Accounts Table -->
<div class="card">
    <div style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    <th>Account Code</th>
                    <th>Account Name</th>
                    <th>Type</th>
                    <th>Parent Account</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for account in accounts %}
                <tr>
                    <td>
                        <strong style="color: var(--primary);">{{ account.account_code }}</strong>
                    </td>
                    <td>{{ account.account_name }}</td>
                    <td>
                        <span class="status-badge 
                            {% if account.account_type == 'assets' %}status-paid
                            {% elif account.account_type == 'liabilities' %}status-not-paid
                            {% elif account.account_type == 'equity' %}status-pending
                            {% elif account.account_type == 'income' %}status-paid
                            {% elif account.account_type == 'expense' %}status-not-paid
                            {% endif %}">
                            {{ account.get_account_type_display }}
                        </span>
                    </td>
                    <td>
                        {% if account.parent_account %}
                            {{ account.parent_account.account_code }} - {{ account.parent_account.account_name }}
                        {% else %}
                            <span style="color: var(--muted);">Root Account</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="status-badge 
                            {% if account.status == 'confirmed' %}status-paid
                            {% elif account.status == 'new' %}status-pending
                            {% else %}status-draft
                            {% endif %}">
                            {{ account.get_status_display }}
                        </span>
                    </td>
                    <td>
                        <div style="display: flex; gap: 8px;">
                            <a href="{% url 'chart_of_accounts_edit' account.pk %}" 
                               style="color: var(--primary); text-decoration: none;" title="Edit">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/>
                                </svg>
                            </a>
                            {% if account.status != 'archived' %}
                            <a href="#" onclick="archiveAccount({{ account.pk }})" 
                               style="color: var(--danger); text-decoration: none;" title="Archive">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3,3H21V7H20V19A2,2 0 0,1 18,21H6A2,2 0 0,1 4,19V7H3V3M5,7V19H19V7H5M7,9H17V11H7V9M7,12H14V14H7V12Z"/>
                                </svg>
                            </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center; color: var(--muted); padding: 40px;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" style="opacity: 0.3; margin-bottom: 16px;">
                            <path d="M19,3H5C3.9,3 3,3.9 3,5V19C3,20.1 3.9,21 5,21H19C20.1,21 21,20.1 21,19V5C21,3.9 20.1,3 19,3M19,19H5V5H19V19Z"/>
                        </svg>
                        <div>No accounts found</div>
                        <div style="font-size: 0.9rem; margin-top: 8px;">
                            <a href="{% url 'chart_of_accounts_create' %}" style="color: var(--primary);">Create your first account</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Account Type Legend -->
<div class="card" style="margin-top: 20px;">
    <h3 style="margin-bottom: 16px; color: var(--text);">Account Types</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
        <div style="padding: 12px; border-left: 4px solid var(--success); background: rgba(16,185,129,0.1);">
            <strong style="color: var(--success);">Assets</strong>
            <div style="font-size: 0.9rem; color: var(--muted); margin-top: 4px;">
                Resources owned by the company (Cash, Bank, Inventory, etc.)
            </div>
        </div>
        <div style="padding: 12px; border-left: 4px solid var(--danger); background: rgba(239,68,68,0.1);">
            <strong style="color: var(--danger);">Liabilities</strong>
            <div style="font-size: 0.9rem; color: var(--muted); margin-top: 4px;">
                Debts and obligations (Accounts Payable, Loans, etc.)
            </div>
        </div>
        <div style="padding: 12px; border-left: 4px solid var(--warning); background: rgba(245,158,11,0.1);">
            <strong style="color: var(--warning);">Equity</strong>
            <div style="font-size: 0.9rem; color: var(--muted); margin-top: 4px;">
                Owner's stake in the company (Capital, Retained Earnings, etc.)
            </div>
        </div>
        <div style="padding: 12px; border-left: 4px solid var(--primary); background: rgba(0,245,255,0.1);">
            <strong style="color: var(--primary);">Income</strong>
            <div style="font-size: 0.9rem; color: var(--muted); margin-top: 4px;">
                Revenue and earnings (Sales, Service Income, etc.)
            </div>
        </div>
        <div style="padding: 12px; border-left: 4px solid var(--secondary); background: rgba(255,46,209,0.1);">
            <strong style="color: var(--secondary);">Expense</strong>
            <div style="font-size: 0.9rem; color: var(--muted); margin-top: 4px;">
                Costs and expenditures (Rent, Utilities, Salaries, etc.)
            </div>
        </div>
    </div>
</div>

<script>
function archiveAccount(accountId) {
    if (confirm('Are you sure you want to archive this account? This action cannot be undone.')) {
        // Add AJAX call to archive account
        fetch(`/transactions/chart-of-accounts/${accountId}/archive/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error archiving account: ' + data.error);
            }
        })
        .catch(error => {
            alert('Error archiving account: ' + error);
        });
    }
}
</script>
{% endblock %}