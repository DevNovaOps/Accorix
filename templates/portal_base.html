<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Portal - ACCORIX{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/portal.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>

{% if user.is_authenticated %}
<!-- ================= PORTAL TOP MENU ================= -->
<div class="portal-menu">
    
    <div class="portal-brand">
        <div style="display:flex; align-items:center; gap:12px; cursor:pointer;" onclick="window.location='{% url 'portal_dashboard' %}'">
            <div style="width:35px; height:35px; color:var(--primary);">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width:100%; height:100%;">
                    <path d="M12 2L2 19h20L12 2zm0 3.8L17.5 17h-11L12 5.8z" style="opacity:0.4;" />
                    <path d="M13.5 10l-2.5 4.5h-3l4-7 5 9h-2l-1.5-2.5z" style="fill:var(--secondary);"/> 
                </svg>
            </div>
            <div style="display:flex; flex-direction:column;">
                <h3 style="margin:0; color:var(--text); font-size:18px; font-weight:800; letter-spacing:1px; line-height:1;">ACCORIX</h3>
                <span style="font-size:9px; color:var(--muted); font-weight:600; letter-spacing:0.3em; text-transform:uppercase;">Portal</span>
            </div>
        </div>
    </div>


    <div class="portal-nav">
        <a href="{% url 'portal_dashboard' %}" class="portal-nav-item {% if request.resolver_match.url_name == 'portal_dashboard' %}active{% endif %}">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3,13H11V3H3M3,21H11V15H3M13,21H21V11H13M13,3V9H21V3"/>
            </svg>
            <span>Dashboard</span>
        </a>
        
        {% if user.role == 'customer' %}
        <a href="{% url 'portal_invoices' %}" class="portal-nav-item {% if request.resolver_match.url_name == 'portal_invoices' %}active{% endif %}">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
            </svg>
            <span>My Invoices</span>
        </a>
        
        <a href="{% url 'portal_orders' %}" class="portal-nav-item {% if request.resolver_match.url_name == 'portal_orders' %}active{% endif %}">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7,4V2A1,1 0 0,1 8,1H16A1,1 0 0,1 17,2V4H20A1,1 0 0,1 21,5V6A1,1 0 0,1 20,7H19V19A3,3 0 0,1 16,22H8A3,3 0 0,1 5,19V7H4A1,1 0 0,1 3,6V5A1,1 0 0,1 4,4H7M9,3V4H15V3H9M7,7V19A1,1 0 0,0 8,20H16A1,1 0 0,0 17,19V7H7Z"/>
            </svg>
            <span>My Orders</span>
        </a>
        {% endif %}
        
        {% if user.role == 'vendor' %}
        <a href="{% url 'portal_bills' %}" class="portal-nav-item {% if request.resolver_match.url_name == 'portal_bills' %}active{% endif %}">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6,2A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6M6,4H13V9H18V20H6V4Z"/>
            </svg>
            <span>My Bills</span>
        </a>
        
        <a href="{% url 'portal_orders' %}" class="portal-nav-item {% if request.resolver_match.url_name == 'portal_orders' %}active{% endif %}">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7,4V2A1,1 0 0,1 8,1H16A1,1 0 0,1 17,2V4H20A1,1 0 0,1 21,5V6A1,1 0 0,1 20,7H19V19A3,3 0 0,1 16,22H8A3,3 0 0,1 5,19V7H4A1,1 0 0,1 3,6V5A1,1 0 0,1 4,4H7M9,3V4H15V3H9M7,7V19A1,1 0 0,0 8,20H16A1,1 0 0,0 17,19V7H7Z"/>
            </svg>
            <span>My Orders</span>
        </a>
        {% endif %}
    </div>

    <!-- PORTAL USER INFO & ACTIONS -->
    <div class="portal-user-section">
        <div class="portal-user-info">
            <div class="portal-user-avatar">
                {{ user.first_name.0|default:"U" }}{{ user.last_name.0|default:"" }}
            </div>
            <div class="portal-user-details">
                <div class="portal-user-name">{{ user.first_name }} {{ user.last_name }}</div>
                <div class="portal-user-role">{{ user.get_role_display }}</div>
                {% if user.contact %}
                <div class="portal-user-company">{{ user.contact.name }}</div>
                {% endif %}
            </div>
        </div>
        
        <div class="portal-actions">
            <button class="portal-action-btn" id="portalThemeToggle" title="Toggle Theme">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12,18C11.11,18 10.26,17.8 9.5,17.45C11.56,16.5 13,14.42 13,12C13,9.58 11.56,7.5 9.5,6.55C10.26,6.2 11.11,6 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31L23.31,12L20,8.69Z"/>
                </svg>
            </button>
            
            <a href="{% url 'logout' %}" class="portal-action-btn portal-logout" title="Logout">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z"/>
                </svg>
            </a>
        </div>
    </div>

</div>

<!-- ================= PORTAL CONTENT AREA ================= -->
<div class="portal-content" id="portalPageContent">
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="message {% if message.tags == 'error' %}error{% elif message.tags == 'success' %}success{% else %}info{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
{% endif %}

{% if not user.is_authenticated %}
    {% if messages %}
    <div class="messages" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 3000; max-width: 500px;">
        {% for message in messages %}
        <div class="message {% if message.tags == 'error' %}error{% elif message.tags == 'success' %}success{% else %}info{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
{% endif %}

{% block content %}{% endblock %}

{% if user.is_authenticated %}
</div>
{% endif %}

<script>
// Portal Theme Toggle
const portalThemeToggle = document.getElementById('portalThemeToggle');
const html = document.documentElement;

function initPortalTheme() {
    const saved = localStorage.getItem('erp-theme') || 'dark';
    html.setAttribute('data-theme', saved);
    updateThemeIcon(saved);
}

function updateThemeIcon(theme) {
    if (portalThemeToggle) {
        const icon = portalThemeToggle.querySelector('svg path');
        if (theme === 'dark') {
            // Moon icon
            icon.setAttribute('d', 'M12,18C11.11,18 10.26,17.8 9.5,17.45C11.56,16.5 13,14.42 13,12C13,9.58 11.56,7.5 9.5,6.55C10.26,6.2 11.11,6 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31L23.31,12L20,8.69Z');
        } else {
            // Sun icon
            icon.setAttribute('d', 'M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8M12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31L23.31,12L20,8.69Z');
        }
    }
}

if (portalThemeToggle) {
    portalThemeToggle.addEventListener('click', () => {
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('erp-theme', next);
        updateThemeIcon(next);
    });
}

initPortalTheme();
</script>
{% block extra_js %}{% endblock %}
</body>
</html>